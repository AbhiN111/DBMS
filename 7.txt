CREATE TABLE Cust_Old (CustID INT PRIMARY KEY, CustName VARCHAR(50));

CREATE TABLE Cust_New (CustID INT, CustName VARCHAR(50));

INSERT INTO Cust_Old VALUES (1,'Amit'),(2,'Riya');

INSERT INTO Cust_New VALUES (2,'Riya'),(3,'Pratik'),(4,'Sneha');

DELIMITER $$
CREATE PROCEDURE merge_customers(IN min_id INT)
BEGIN
DECLARE v_id INT;
DECLARE v_name VARCHAR(50);
DECLARE done INT DEFAULT 0;
DECLARE cur CURSOR FOR 
SELECT CustID, CustName FROM Cust_New WHERE CustID >= min_id;
DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
OPEN cur;
read_loop: LOOP
FETCH cur INTO v_id, v_name;
IF done = 1 THEN
LEAVE read_loop;
END IF;
IF NOT EXISTS (SELECT * FROM Cust_Old WHERE CustID = v_id) THEN
INSERT INTO Cust_Old VALUES(v_id, v_name);
END IF;
END LOOP;
CLOSE cur;
END $$
DELIMITER ;

CALL merge_customers(1);

SELECT * FROM Cust_Old;


